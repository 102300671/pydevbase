# TCP聊天

## TCP服务端

 ```python
import socket
import threading


class Tcp_server():
    def __init__(self, message,port):
        self.message = message
        self.server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        self.server.bind(("0.0.0.0", port))
        self.server.listen()
        print("[TCP 服务器] 等待连接...")
        self.client, addr = self.server.accept()
        print(f"[TCP服务器] 已连接:{addr}")
        self.client.send(self.message.encode())

    def send_to(self):
        while True:
            message = input("[TCP服务器] 请输入消息:")
            if message == "exit":
                self.client.send("TCP服务器即将关闭".encode())
                self.client.close()
                self.server.close()
                print("[TCP服务器] 服务器已关闭")
                break
            else:
                print("[TCP服务器] 正在发送消息")
                self.client.send(message.encode())

    def receive(self):
        while True:
            data = self.client.recv(1024)
            message = data.decode()
            print(f"[TCP客户端] 收到消息:{message}")
            if message == "TCP客户端即将关闭":
                print("[TCP服务器] 挂起，等待客户端重新连接...")
                self.client.close()
                self.client, addr = self.server.accept()
                print(f"[TCP服务器] 已重新连接:{addr}")


message = "Hello Client"
port = int(input("请输入端口:"))
tcp = Tcp_server(message, port)
send_thread = threading.Thread(target=tcp.send_to)
receive_thread = threading.Thread(target=tcp.receive)
send_thread.start()
receive_thread.start()
send_thread.join()
receive_thread.join()

```

## TCP客户端

```python
import socket
import threading


class Tcp_client():
    def __init__(self, message,ip,port):
        self.message = message
        self.ip = ip
        self.port = port
        self.client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        print("[TCP客户端] 正在连接服务器...")
        self.client.connect((self.ip, self.port))
        print("[TCP客户端] 连接到服务器")
        self.client.send(self.message.encode())

    def receive(self):
        while True:
            data = self.client.recv(1024)
            print(f"[TCP客户端] 收到消息:{data.decode()}")
            if data.decode() == "TCP服务器即将关闭":
                print("即将关闭TCP客户端")
                self.client.close()
                print("TCP客户端已关闭")
                break

    def send_to(self):
        while True:
            message = input("[TCP客户端] 请输入消息:")
            if message == "exit":
                self.client.send("TCP客户端即将关闭".encode())
                self.client.close()
                print("[TCP客户端] 已关闭")
                break
            else:
                print("[TCP客户端] 正在发送消息")
                self.client.send(message.encode())


message = "Hello Client"
ip = input("请输入IP地址:")
port = int(input("请输入端口号:"))
tcp = Tcp_client(message,ip,port)
send_thread = threading.Thread(target=tcp.send_to)
receive_thread = threading.Thread(target=tcp.receive)
send_thread.start()
receive_thread.start()
send_thread.join()
receive_thread.join()
```
